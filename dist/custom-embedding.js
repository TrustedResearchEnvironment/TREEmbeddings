/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ var __webpack_modules__ = ({

/***/ "./index.ts":
/*!******************!*\
  !*** ./index.ts ***!
  \******************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   definition: () => (/* binding */ definition)\n/* harmony export */ });\n/* harmony import */ var _library_base__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./library-base */ \"./library-base.ts\");\n/* harmony import */ var _src_templates_dataset_template__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./src/templates/dataset.template */ \"./src/templates/dataset.template.ts\");\n/* harmony import */ var _src_styles_dataset_styles__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./src/styles/dataset.styles */ \"./src/styles/dataset.styles.ts\");\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n\n\n\nclass CustomEmbed extends _library_base__WEBPACK_IMPORTED_MODULE_0__.LibraryBase {\n    constructor(element, entityUrl, params, settings, errorCallback) {\n        super(element, entityUrl, params, settings, errorCallback);\n        this.token = \"\";\n        this.loadResources = () => __awaiter(this, void 0, void 0, function* () {\n            yield this.getAccessToken();\n            yield this.buildPage();\n        });\n        this.getAccessToken = () => __awaiter(this, void 0, void 0, function* () {\n            var _a;\n            try {\n                // A way to get the runtime param passed down from the portal\n                const authId = (_a = this.getParamValue('ApiAuthRequestId')) === null || _a === void 0 ? void 0 : _a.value;\n                const authResponse = yield window.loomeApi.runApiRequest(authId);\n                this.token = authResponse.access_token;\n            }\n            catch (ex) {\n                // Additional debug logs, won't hurt to get additional raw info\n                console.log(ex);\n                const error = ex;\n                this.errorCallback(\"Error\", \"Unable obtain access token\", error.message, this.element);\n            }\n        });\n        this.buildPage = () => __awaiter(this, void 0, void 0, function* () {\n            var _a;\n            try {\n                const DataSet = yield window.loomeApi.runApiRequest(6, {\n                    DataSetID: ((_a = this.getParamValue('DataSetID')) === null || _a === void 0 ? void 0 : _a.value) || '',\n                });\n                let columnsHtml = '';\n                if (DataSet.DataSetColumns && Array.isArray(DataSet.DataSetColumns)) {\n                    // ...existing columnsHtml generation...\n                }\n                // Use the imported template and styles\n                const datasetHtml = (0,_src_templates_dataset_template__WEBPACK_IMPORTED_MODULE_1__.getDatasetTemplate)(DataSet, columnsHtml);\n                // Set the innerHTML with imported styles\n                this.element.innerHTML = _src_styles_dataset_styles__WEBPACK_IMPORTED_MODULE_2__.datasetStyles + datasetHtml;\n                // --- 4. Add event handlers after rendering ---\n                setTimeout(() => {\n                    // Get the modal elements\n                    const requestDatasetModal = document.getElementById('requestDatasetModal');\n                    const helpModal = document.getElementById('helpModal');\n                    // Get the buttons that open the modals\n                    const requestDatasetBtn = document.getElementById('requestDatasetBtn');\n                    const helpBtn = document.getElementById('helpBtn');\n                    const exportBtn = document.getElementById('exportBtn');\n                    // Get the <span> elements that close the modals\n                    const closeButtons = document.getElementsByClassName('close');\n                    // Table sorting variables\n                    let currentSortColumn = \"name\";\n                    let currentSortDirection = \"desc\";\n                    // Function to sort table\n                    function sortTable(tableId, columnIndex, columnName) {\n                        const table = document.getElementById(tableId);\n                        if (!table)\n                            return;\n                        const tbody = table.querySelector('tbody');\n                        if (!tbody)\n                            return;\n                        const rows = Array.from(tbody.querySelectorAll('tr'));\n                        // Update sort indicators\n                        const headers = table.querySelectorAll('th.sortable');\n                        headers.forEach(header => {\n                            const indicator = header.querySelector('.sort-indicator');\n                            if (indicator) {\n                                indicator.textContent = '';\n                            }\n                            header.removeAttribute('data-sort-direction');\n                        });\n                        // Determine sort direction\n                        if (currentSortColumn === columnName) {\n                            currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';\n                        }\n                        else {\n                            currentSortColumn = columnName;\n                            currentSortDirection = 'asc';\n                        }\n                        // Update current header\n                        const currentHeader = table.querySelector(`th[data-sort=\"${columnName}\"]`);\n                        if (currentHeader) {\n                            const indicator = currentHeader.querySelector('.sort-indicator');\n                            if (indicator) {\n                                indicator.textContent = currentSortDirection === 'asc' ? '▲' : '▼';\n                            }\n                            currentHeader.setAttribute('data-sort-direction', currentSortDirection);\n                        }\n                        // Sort the rows\n                        rows.sort((a, b) => {\n                            const aValue = (a.cells[columnIndex].textContent || '').trim();\n                            const bValue = (b.cells[columnIndex].textContent || '').trim();\n                            // Determine if we're sorting a data type column\n                            if (columnName === 'type') {\n                                // Special comparison for data types\n                                return currentSortDirection === 'asc'\n                                    ? aValue.localeCompare(bValue)\n                                    : bValue.localeCompare(aValue);\n                            }\n                            // Default comparison\n                            return currentSortDirection === 'asc'\n                                ? aValue.localeCompare(bValue)\n                                : bValue.localeCompare(aValue);\n                        });\n                    }\n                    // Function to export table data to CSV\n                    function exportTableToCSV(tableId, filename = '') {\n                        const table = document.getElementById(tableId);\n                        if (!table)\n                            return;\n                        // Generate filename if not provided\n                        if (!filename) {\n                            const date = new Date().toISOString().slice(0, 10);\n                            filename = `Dataset_${DataSet.DataSetID}_${date}.csv`;\n                        }\n                        // Get all rows\n                        const rows = table.querySelectorAll('tr');\n                        // Prepare CSV content\n                        const csvContent = [];\n                        // Process each row\n                        rows.forEach(row => {\n                            const rowData = [];\n                            const cells = row.querySelectorAll('th, td');\n                            cells.forEach(cell => {\n                                // Get text content and escape quotes\n                                let text = (cell.textContent || '').trim().replace(/\"/g, '\"\"');\n                                // Wrap in quotes to handle commas\n                                rowData.push(`\"${text}\"`);\n                            });\n                            csvContent.push(rowData.join(','));\n                        });\n                        // Create CSV content\n                        const csvData = csvContent.join('\\\\n');\n                        // Create download link\n                        const blob = new Blob([csvData], { type: 'text/csv;charset=utf-8;' });\n                        const link = document.createElement('a');\n                        // Set up download\n                        if ('msSaveBlob' in navigator) { // For IE\n                            navigator.msSaveBlob(blob, filename);\n                        }\n                        else {\n                            // For other browsers\n                            link.href = URL.createObjectURL(blob);\n                            link.setAttribute('download', filename);\n                            link.style.visibility = 'hidden';\n                            document.body.appendChild(link);\n                            link.click();\n                            document.body.removeChild(link);\n                        }\n                    }\n                    // Function to create a dataset request\n                    function CreateRequest() {\n                        // Get the modal's body element\n                        const modalBody = document.getElementById('requestDatasetModalBody');\n                        if (!modalBody || !requestDatasetModal)\n                            return;\n                        // Create the form for the request\n                        const formHtml = `\r\n                        <div class=\"col-md-12\">\r\n                            <form id=\"requestForm\">\r\n                                <!-- Request Name Field -->\r\n                                <div class=\"form-group\">\r\n                                    <label for=\"RequestName\" class=\"control-label\">Request Name</label>\r\n                                    <input id=\"RequestName\" class=\"form-control\" placeholder=\"Name for this request\" required>\r\n                                </div>\r\n\r\n                                <!-- Assist Project Field -->\r\n                                <div class=\"form-group\" >\r\n                                    <label for=\"ProjectID\" class=\"control-label\">Assist Project</label>\r\n                                    <select id=\"ProjectID\" class=\"form-select\" required>\r\n                                        <option value=\"\">Select a Project</option>\r\n                                        <option value=\"82\">Project 1</option>\r\n                                        <option value=\"84\">Project 2</option>\r\n                                        <option value=\"85\">Project 3</option>\r\n                                        <option value=\"86\">Project 4</option>\r\n                                    </select>\r\n                                    <div class=\"validation-message\"></div>\r\n                                </div>\r\n                                \r\n                                <!-- Scheduled Refresh Field -->\r\n                                <div class=\"form-group\">\r\n                                    <label for=\"ScheduleRefresh\" class=\"control-label\">Scheduled Refresh</label>\r\n                                    <select id=\"ScheduleRefresh\" class=\"form-select\">\r\n                                        <option value=\"No Refresh\">No Refresh</option>\r\n                                        <option value=\"Daily\">Daily</option>\r\n                                        <option value=\"Weekly\">Weekly</option>\r\n                                        <option value=\"Monthly\">Monthly</option>\r\n                                    </select>\r\n                                </div>\r\n\r\n                                <!-- Action Buttons -->\r\n                                <div class=\"form-group\">\r\n                                    <button type=\"submit\" class=\"btn btn-accent\">Save</button>\r\n                                    <button type=\"button\" class=\"btn btn-default\" id=\"cancelRequest\">Cancel</button>\r\n                                </div>\r\n                            </form>\r\n                        </div>\r\n                        <div style=\"text-align: right; margin-top: 20px;\">\r\n                            <button id=\"exportRequestBtn\" class=\"btn btn-export\">\r\n                                <i class=\"icon-download\"></i> Export to CSV\r\n                            </button>\r\n                        </div>\r\n                    `;\n                        // Set the content and display the modal\n                        modalBody.innerHTML = formHtml;\n                        requestDatasetModal.style.display = 'block';\n                        // Add event listener for the form submission\n                        const requestForm = document.getElementById('requestForm');\n                        if (requestForm) {\n                            requestForm.addEventListener('submit', function (e) {\n                                e.preventDefault();\n                                alert('Request submitted successfully!');\n                                if (requestDatasetModal) {\n                                    requestDatasetModal.style.display = 'none';\n                                }\n                            });\n                        }\n                        // Add event listener for the cancel button\n                        const cancelButton = document.getElementById('cancelRequest');\n                        if (cancelButton) {\n                            cancelButton.addEventListener('click', function () {\n                                if (requestDatasetModal) {\n                                    requestDatasetModal.style.display = 'none';\n                                }\n                            });\n                        }\n                        // Add event listener for the export button\n                        const exportRequestBtn = document.getElementById('exportRequestBtn');\n                        if (exportRequestBtn) {\n                            exportRequestBtn.addEventListener('click', function () {\n                                const date = new Date().toISOString().slice(0, 10);\n                                const csvContent = `\"Request Name\",\"Project\",\"Scheduled Refresh\"\\n\"Request for ${DataSet.Name}\",\"Project 1\",\"Weekly\"`;\n                                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n                                const link = document.createElement('a');\n                                link.href = URL.createObjectURL(blob);\n                                link.setAttribute('download', `DatasetRequest_${DataSet.DataSetID}_${date}.csv`);\n                                link.style.visibility = 'hidden';\n                                document.body.appendChild(link);\n                                link.click();\n                                document.body.removeChild(link);\n                            });\n                        }\n                    }\n                    if (requestDatasetBtn) {\n                        requestDatasetBtn.addEventListener('click', CreateRequest);\n                    }\n                    if (exportBtn) {\n                        exportBtn.addEventListener('click', function () {\n                            const date = new Date().toISOString().slice(0, 10);\n                            exportTableToCSV('columnsTableBody', `Dataset_${DataSet.DataSetID}_${date}.csv`);\n                        });\n                    }\n                    // Add sorting to the main table\n                    const mainTableHeaders = document.querySelectorAll('.columns-table th.sortable');\n                    mainTableHeaders.forEach((header, index) => {\n                        header.addEventListener('click', function () {\n                            const sortType = this.getAttribute('data-sort');\n                            if (sortType) {\n                                sortTable('columnsTableBody', index, sortType);\n                            }\n                        });\n                    });\n                    // When the user clicks on <span> (x), close the modal\n                    for (let i = 0; i < closeButtons.length; i++) {\n                        closeButtons[i].addEventListener('click', function () {\n                            if (requestDatasetModal) {\n                                requestDatasetModal.style.display = 'none';\n                            }\n                        });\n                    }\n                    // When the user clicks anywhere outside of the modal, close it\n                    window.addEventListener('click', function (event) {\n                        if (event.target === requestDatasetModal && requestDatasetModal) {\n                            requestDatasetModal.style.display = 'none';\n                        }\n                    });\n                    // Initialize with default sort\n                    sortTable('columnsTableBody', 0, 'name');\n                }, 100); // Small delay to ensure DOM is ready\n            }\n            catch (ex) {\n                console.error(\"Error:\", ex);\n                const error = ex;\n                if (error && error.message) {\n                    this.errorCallback(\"Error\", \"Failed to build the dataset page\", error.message, this.element);\n                }\n            }\n        });\n        console.log(params);\n        this.loadResources();\n    }\n}\nconst definition = {\n    version: \"1.0.0\",\n    embedding: {\n        destroy: (element) => {\n            // Clear out the contents of the element\n            element.innerHTML = \"\";\n            // Grab the instance we saved earlier on the element\n            const embedInstance = element.instance;\n            if (embedInstance) {\n                // Call the dispose on the instance first\n                embedInstance.dispose();\n                // Then clean up the reference\n                delete element.instance;\n                console.log('Instance disposed.');\n            }\n        },\n        run: (element, entityUrl, paramValues, settings, errorCallback) => {\n            const instance = new CustomEmbed(element, entityUrl, paramValues, settings, errorCallback);\n            // Store for proper disposal later when the destroy is called\n            element.instance = instance;\n        }\n    }\n};\n\n\n//# sourceURL=webpack://@trustedresearchenvironment/webpack-ts-example/./index.ts?");

/***/ }),

/***/ "./library-base.ts":
/*!*************************!*\
  !*** ./library-base.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LibraryBase: () => (/* binding */ LibraryBase)\n/* harmony export */ });\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nclass LibraryBase {\n    constructor(element, entityUrl, paramValues, settings, errorCallback) {\n        this.loadResourceFiles = () => __awaiter(this, void 0, void 0, function* () {\n        });\n        this.setupEventListeners = () => {\n        };\n        this.dispose = () => {\n        };\n        this.element = element;\n        this.entityUrl = entityUrl;\n        this.paramValues = paramValues;\n        this.settings = settings;\n        this.errorCallback = errorCallback;\n        const embedTypeSetting = this.getSettingValue('embedType');\n        const embedIdSetting = this.getSettingValue('embedId');\n        this.embedType = +(embedTypeSetting === null || embedTypeSetting === void 0 ? void 0 : embedTypeSetting.value);\n        this.embedId = +(embedIdSetting === null || embedIdSetting === void 0 ? void 0 : embedIdSetting.value);\n        this.setupEventListeners();\n    }\n    getSettingValue(name) {\n        var matches = this.settings.filter(x => x.name == name);\n        if (matches.length > 0) {\n            return matches[0];\n        }\n        else {\n            return undefined;\n        }\n    }\n    ;\n    getParamValue(id) {\n        var matches = this.paramValues.filter(x => x.id == id);\n        if (matches.length > 0) {\n            return matches[0];\n        }\n        else {\n            return undefined;\n        }\n    }\n    ;\n    getQueryStringParameter(url, key) {\n        var parts = url.split(\"?\");\n        if (parts.length === 1)\n            return undefined;\n        var paramKeys = parts[1].split(\"&\").map(x => {\n            var keyValuePair = x.split(\"=\");\n            return {\n                key: keyValuePair[0],\n                value: keyValuePair[1]\n            };\n        });\n        var match = paramKeys.find(x => x.key.toLocaleUpperCase() === key.toLocaleUpperCase());\n        return match === undefined ? undefined : match.value;\n    }\n}\n\n\n//# sourceURL=webpack://@trustedresearchenvironment/webpack-ts-example/./library-base.ts?");

/***/ }),

/***/ "./src/styles/dataset.styles.ts":
/*!**************************************!*\
  !*** ./src/styles/dataset.styles.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   datasetStyles: () => (/* binding */ datasetStyles)\n/* harmony export */ });\nconst datasetStyles = `\n    <style>\n        .dataset-container {\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n            max-width: 1200px;\n            margin: 0 auto;\n            padding: 20px;\n        }\n\n        .header-flex {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 15px;\n        }\n\n        .header-flex h2 {\n            margin: 0;\n        }\n\n        .header-flex .btn {\n            margin-left: 20px;\n        }\n\n        .metadata {\n            margin: 10px 0;\n            color: #666;\n        }\n\n        .metadata-item {\n            margin-right: 20px;\n        }\n\n        .dataset-description {\n            margin: 15px 0;\n        }\n    </style>\n`;\n\n\n//# sourceURL=webpack://@trustedresearchenvironment/webpack-ts-example/./src/styles/dataset.styles.ts?");

/***/ }),

/***/ "./src/templates/dataset.template.ts":
/*!*******************************************!*\
  !*** ./src/templates/dataset.template.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getDatasetTemplate: () => (/* binding */ getDatasetTemplate)\n/* harmony export */ });\nconst getDatasetTemplate = (DataSet, columnsHtml) => {\n    return `\n        <div class=\"dataset-container\">\n            <div class=\"breadcrumb\">\n                <span>Datasets</span>\n                <span class=\"separator\">›</span>\n                <span class=\"current\">Dataset Details</span>\n            </div>\n            \n            <div class=\"dataset-card\">\n                <div class=\"dataset-header\">\n                    <div class=\"header-flex\">\n                        <h2>${DataSet.Name}</h2>\n                        <button id=\"requestDatasetBtn\" class=\"btn btn-success\">\n                            Request Dataset\n                        </button>\n                    </div>\n                    <div class=\"metadata\">\n                        <span class=\"metadata-item\">ID: ${DataSet.DataSetID}</span>\n                        <span class=\"metadata-item\">Owner: ${DataSet.Owner}</span>\n                        <span class=\"metadata-item\">Modified: ${new Date(DataSet.ModifiedDate).toLocaleDateString()}</span>\n                    </div>\n                    <div class=\"dataset-description\">\n                        <p>${DataSet.Description}</p>\n                    </div>\n                </div>\n                ${columnsHtml}\n            </div>\n        </div>\n    `;\n};\n\n\n//# sourceURL=webpack://@trustedresearchenvironment/webpack-ts-example/./src/templates/dataset.template.ts?");

/***/ })

/******/ });
/************************************************************************/
/******/ // The module cache
/******/ var __webpack_module_cache__ = {};
/******/ 
/******/ // The require function
/******/ function __webpack_require__(moduleId) {
/******/ 	// Check if module is in cache
/******/ 	var cachedModule = __webpack_module_cache__[moduleId];
/******/ 	if (cachedModule !== undefined) {
/******/ 		return cachedModule.exports;
/******/ 	}
/******/ 	// Create a new module (and put it into the cache)
/******/ 	var module = __webpack_module_cache__[moduleId] = {
/******/ 		// no module.id needed
/******/ 		// no module.loaded needed
/******/ 		exports: {}
/******/ 	};
/******/ 
/******/ 	// Execute the module function
/******/ 	__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 
/******/ 	// Return the exports of the module
/******/ 	return module.exports;
/******/ }
/******/ 
/************************************************************************/
/******/ /* webpack/runtime/define property getters */
/******/ (() => {
/******/ 	// define getter functions for harmony exports
/******/ 	__webpack_require__.d = (exports, definition) => {
/******/ 		for(var key in definition) {
/******/ 			if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 				Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 			}
/******/ 		}
/******/ 	};
/******/ })();
/******/ 
/******/ /* webpack/runtime/hasOwnProperty shorthand */
/******/ (() => {
/******/ 	__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ })();
/******/ 
/******/ /* webpack/runtime/make namespace object */
/******/ (() => {
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = (exports) => {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/ })();
/******/ 
/************************************************************************/
/******/ 
/******/ // startup
/******/ // Load entry module and return exports
/******/ // This entry module can't be inlined because the eval devtool is used.
/******/ var __webpack_exports__ = __webpack_require__("./index.ts");
/******/ var __webpack_exports__definition = __webpack_exports__.definition;
/******/ export { __webpack_exports__definition as definition };
/******/ 
