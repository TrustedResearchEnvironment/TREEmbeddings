!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TREEntityFolder=t():e.TREEntityFolder=t()}(this,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>s});class n{constructor(e,t,n,o,a){this.loadResourceFiles=()=>{return e=this,t=void 0,o=function*(){},new((n=void 0)||(n=Promise))((function(a,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}l((o=o.apply(e,t||[])).next())}));var e,t,n,o},this.setupEventListeners=()=>{},this.dispose=()=>{},this.element=e,this.entityUrl=t,this.paramValues=n,this.settings=o,this.errorCallback=a;const s=this.getSettingValue("embedType"),i=this.getSettingValue("embedId");this.embedType=+(null==s?void 0:s.value),this.embedId=+(null==i?void 0:i.value),this.setupEventListeners()}getSettingValue(e){var t=this.settings.filter((t=>t.name==e));return t.length>0?t[0]:void 0}getParamValue(e){var t=this.paramValues.filter((t=>t.id==e));return t.length>0?t[0]:void 0}getQueryStringParameter(e,t){var n=e.split("?");if(1!==n.length){var o=n[1].split("&").map((e=>{var t=e.split("=");return{key:t[0],value:t[1]}})).find((e=>e.key.toLocaleUpperCase()===t.toLocaleUpperCase()));return void 0===o?void 0:o.value}}}var o=function(e,t,n,o){return new(n||(n=Promise))((function(a,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}l((o=o.apply(e,t||[])).next())}))};class a extends n{constructor(e,t,n,a,s){super(e,t,n,a,s),this.token="",this.allColumns=[],this.currentSortColumn="name",this.currentSortDirection="asc",this.currentPage=1,this.rowsPerPage=10,this.dataSet=null,this.initialize=()=>o(this,void 0,void 0,(function*(){this.disableBrowserCache(),yield this.buildPage()})),this.getAccessToken=()=>o(this,void 0,void 0,(function*(){var e;try{const t=null===(e=this.getParamValue("ApiAuthRequestId"))||void 0===e?void 0:e.value,n=yield window.loomeApi.runApiRequest(t);this.token=n.access_token}catch(e){console.log(e);const t=e;this.errorCallback("Error","Unable obtain access token",t.message,this.element)}})),this.buildPage=()=>o(this,void 0,void 0,(function*(){var e,t;try{this.dataSet=yield window.loomeApi.runApiRequest("GetDataSetID",{DataSetID:(null===(e=this.getParamValue("DataSetID"))||void 0===e?void 0:e.value)||""});const n=yield window.loomeApi.runApiRequest("GetDatasetIDColumns",{DataSetID:(null===(t=this.getParamValue("DataSetID"))||void 0===t?void 0:t.value)||""});if(this.allColumns=n.Results?n.Results.sort(((e,t)=>e.DisplayOrder-t.DisplayOrder)):[],!this.dataSet)throw new Error("Dataset information not available");const o=this.generateMainLayout(this.dataSet),a=this.generateStyles();this.element.innerHTML=a+o,this.setupEventListeners(),this.updateTable()}catch(e){console.error("Error:",e);const t=e;t&&t.message&&this.errorCallback("Error","Failed to build the dataset page",t.message,this.element)}})),this.setupEventListeners=()=>{try{document.querySelectorAll("#dataTable th[data-sort]").forEach((e=>{e.addEventListener("click",(()=>{const t=e.getAttribute("data-sort");t&&(this.currentSortColumn===t?this.currentSortDirection="asc"===this.currentSortDirection?"desc":"asc":(this.currentSortColumn=t,this.currentSortDirection="asc"),this.currentPage=1,this.updateTable())}))}));const e=document.getElementById("pageSize");e&&e.addEventListener("change",(e=>{const t=parseInt(e.target.value);isNaN(t)||(this.rowsPerPage=t,this.currentPage=1,this.updateTable())}));const t=document.querySelector(".prev-page"),n=document.querySelector(".next-page");t&&t.addEventListener("click",(()=>{this.currentPage>1&&(this.currentPage--,this.updateTable())})),n&&n.addEventListener("click",(()=>{const e=Math.ceil(this.allColumns.length/this.rowsPerPage);this.currentPage<e&&(this.currentPage++,this.updateTable())}));const a=document.getElementById("requestDatasetBtn");a&&a.addEventListener("click",(()=>o(this,void 0,void 0,(function*(){console.log("Button clicked, attempting to fetch projects..."),a.disabled=!0;try{console.log("Before API call"),yield this.createRequestModal(),console.log("After API call")}catch(e){console.error("Error in button click handler:",e)}finally{a.disabled=!1}}))));const s=document.getElementById("requestForm");s&&s.addEventListener("submit",(e=>o(this,void 0,void 0,(function*(){var t,n,o;e.preventDefault();try{if(!this.dataSet)throw new Error("Dataset information not available");const e={requestName:null===(t=document.getElementById("RequestName"))||void 0===t?void 0:t.value,projectId:null===(n=document.getElementById("ProjectID"))||void 0===n?void 0:n.value,description:null===(o=document.getElementById("RequestDescription"))||void 0===o?void 0:o.value,datasetId:this.dataSet.DataSetID,approvers:this.dataSet.Approvers};yield window.loomeApi.runApiRequest("RequestDataSet",{DataSetID:e.datasetId,approvers:e.approvers,assistProjectID:parseInt(e.projectId),description:e.description,requestName:e.requestName}),alert("Request submitted successfully!");const a=document.getElementById("requestDatasetModal");a&&a.classList.remove("show")}catch(e){console.error("Error submitting request:",e),alert("Failed to submit request. Please try again.")}}))))}catch(e){console.error("Error setting up event listeners:",e)}},this.updateTable=()=>{const e=document.getElementById("columnsTableBody");if(!e)return;const t=(this.currentPage-1)*this.rowsPerPage,n=t+this.rowsPerPage,o=this.allColumns.slice(t,n);let a="";o.forEach((e=>{a+=`\n                <tr>\n                    <td>${e.ColumnName||""}</td>\n                    <td><span class="mui-chip">${e.ColumnType||""}</span></td>\n                    <td>${e.LogicalColumnName||""}</td>\n                    <td>${e.BusinessDescription||"N/A"}</td>\n                    <td><span class="code-cell">${e.ExampleValue||"N/A"}</span></td>\n                    <td>${e.Redact?'<span class="mui-chip success">Yes</span>':'<span class="mui-chip">No</span>'}</td>\n                    <td>${e.Tokenise?'<span class="mui-chip success">Yes</span>':'<span class="mui-chip">No</span>'}</td>\n                </tr>\n            `})),e.innerHTML=a;try{this.updateSortIcons();const e=document.getElementById("pageSize");e&&(e.value=this.rowsPerPage.toString());const t=document.querySelector(".pagination-info");if(t){const e=(this.currentPage-1)*this.rowsPerPage+1,n=Math.min(e+this.rowsPerPage-1,this.allColumns.length);t.innerHTML=`\n                    Showing ${e} to ${n} of ${this.allColumns.length} entries\n                `}}catch(e){console.error("Error updating table UI:",e)}},this.updateSortIcons=()=>{document.querySelectorAll(".table th.sortable i").forEach((e=>{e.classList.remove("bi-sort-up","bi-sort-down"),e.classList.add("bi-sort")}));const e=document.querySelector(`.table th[data-sort="${this.currentSortColumn}"] i`);e&&(e.classList.remove("bi-sort"),e.classList.add("asc"===this.currentSortDirection?"bi-sort-up":"bi-sort-down"))},this.updatePaginationButtons=()=>{const e=Math.ceil(this.allColumns.length/this.rowsPerPage),t=document.querySelector(".prev-page"),n=document.querySelector(".next-page");t&&t.classList.toggle("disabled",1===this.currentPage),n&&n.classList.toggle("disabled",this.currentPage>=e)},this.createRequestModal=()=>o(this,void 0,void 0,(function*(){const e=document.getElementById("requestDatasetModal");if(e)try{console.log("Fetching projects...");const t=yield window.loomeApi.runApiRequest("GetAssistProjectsFilteredByUpn",{});if(!t||!Array.isArray(t.Results))throw new Error("Invalid API response structure.");const n=document.getElementById("ProjectID");if(!n)throw new Error("Project select element not found");const o=n.options[0];n.innerHTML="",n.appendChild(o),t.Results.forEach((e=>{if(e.IsActive){const t=document.createElement("option");t.value=e.AssistProjectID.toString(),t.textContent=e.Name,t.title=e.Description||"",n.appendChild(t)}})),e.classList.add("show");const a=()=>e.classList.remove("show");e.querySelectorAll(".modal-close").forEach((e=>e.addEventListener("click",a))),e.addEventListener("click",(t=>{t.target===e&&a()}))}catch(e){console.error("Error in createRequestModal:",e),console.error("Full error details:",{name:e instanceof Error?e.name:"Unknown",message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),e instanceof Error&&this.errorCallback("Error","Failed to load projects",`Error details: ${e.message}`,this.element)}})),this.initialize()}generateMainLayout(e){return`\n            <div id="datasetRoot">\n                \x3c!-- Modal --\x3e\n                <div id="requestDatasetModal" class="modal">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h3>Request Data Set</h3>\n                            <span class="modal-close">&times;</span>\n                        </div>\n                        <div class="modal-body">\n                            <form id="requestForm" class="request-form">\n                                <div class="form-group">\n                                    <label for="RequestName">Request Name</label>\n                                    <input id="RequestName" class="form-input" placeholder="Name for this request" required>\n                                </div>\n                                <div class="form-group">\n                                    <label for="RequestDescription">Description</label>\n                                    <input id="RequestName" class="form-input" placeholder="Description for this request" required>\n                                </div>\n                                <div class="form-group">\n                                    <label for="ProjectID">Assist Project</label>\n                                    <select id="ProjectID" class="form-select" required>\n                                        <option value="">Select a Project</option>\n                                        <option value="82">Project 1</option>\n                                        <option value="84">Project 2</option>\n                                        <option value="85">Project 3</option>\n                                    </select>\n                                </div>\n                                <div class="form-actions">\n                                    <button type="submit" class="button button-primary">Submit Request</button>\n                                </div>\n                            </form>\n                        </div>\n                    </div>\n                </div>\n                <div class="mui-card">\n                    <div class="card-header">\n                        <div class="header-content">\n                            <h2>${e.Name}</h2>\n                            <button id="requestDatasetBtn">\n                                <span class="material-icons">data_exploration</span>\n                                Request Data Set\n                            </button>\n                        </div>\n                        <div class="metadata">\n                            <div class="chips">\n                                <span class="mui-chip">ID: ${e.DataSetID}</span>\n                                <span class="mui-chip">Owner: ${e.Owner}</span>\n                                <span class="mui-chip">Modified: ${new Date(e.ModifiedDate).toLocaleDateString()}</span>\n                            </div>\n                            <p>${e.Description}</p>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="mui-card table-card">\n                    <div class="table-container">\n                        <table id="dataTable">\n                            <thead>\n                                <tr>\n                                    <th data-sort="ColumnName">Column Name</th>\n                                    <th data-sort="ColumnType">Data Type</th>\n                                    <th data-sort="LogicalColumnName">Logical Name</th>\n                                    <th data-sort="BusinessDescription">Description</th>\n                                    <th data-sort="ExampleValue">Example</th>\n                                    <th data-sort="Redact">Redacted</th>\n                                    <th data-sort="Tokenise">Deidentified</th>\n                                </tr>\n                            </thead>\n                            <tbody id="columnsTableBody"></tbody>\n                        </table>\n                    </div>\n                    <div class="table-pagination">\n                        <div class="pagination-controls">\n                            <div class="pagination-info"></div>\n                            <div class="pagination-actions">\n                                <select id="pageSize" class="rows-select">\n                                    <option value="10">10</option>\n                                    <option value="25">25</option>\n                                    <option value="50">50</option>\n                                </select>\n                                <button class="prev-page">Previous</button>\n                                <button class="next-page">Next</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `}generateStyles(){if(!document.querySelector("#material-icons-font")){const e=document.createElement("link");e.id="material-icons-font",e.rel="stylesheet",e.href="https://fonts.googleapis.com/icon?family=Material+Icons",document.head.appendChild(e)}return'\n            <style>\n                #datasetRoot {\n                    padding: 24px;\n                    font-family: "Roboto", "Helvetica", "Arial";\n                }\n                #entity-page-embed {\n                    overflow:scroll;\n                }\n                .mui-card {\n                    background: #fff;\n                    border-radius: 4px;\n                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n                    margin-bottom: 24px;\n                }\n                .card-header {\n                    padding: 16px 24px;\n                }\n                .header-content {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                }\n                .header-content h2 {\n                    font-weight: 700;\n                    font-size: 1.5rem;\n                    margin: 0;\n                    color: #2c3e50;\n                }\n                .metadata {\n                    margin-top: 16px;\n                }\n                .chips {\n                    display: flex;\n                    gap: 8px;\n                    margin-bottom: 8px;\n                }\n                .mui-chip {\n                    background: #e0e0e0;\n                    padding: 4px 12px;\n                    border-radius: 16px;\n                    font-size: 0.875rem;\n                }\n                .table-container {\n                    overflow-x: auto;\n                    // max-height: 500px;\n                    // overflow-y: auto;\n                }\n                #dataTable {\n                    width: 100%;\n                    border-collapse: collapse;\n                }\n                #dataTable th {\n                    background: #f5f5f5;\n                    padding: 16px;\n                    text-align: left;\n                    font-weight: 700;\n                    cursor: pointer;\n                    color: #2c3e50;\n                    font-size: 0.95rem;\n                    // position: sticky;\n                    // top: 0;\n                }\n                #dataTable td {\n                    padding: 16px;\n                    border-bottom: 1px solid #e0e0e0;\n                }\n                .table-pagination {\n                    padding: 16px;\n                    display: flex;\n                    justify-content: flex-end;\n                    align-items: center;\n                }\n                #requestDatasetBtn {\n                    padding: 8px 16px;\n                    background: #4EC4BC;\n                    color: white;\n                    border: none;\n                    border-radius: 4px;\n                    cursor: pointer;\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                    box-shadow: 0 4px 4px rgba(0,0,0,0.1);\n                    font-size: 15px;\n                }\n                #requestDatasetBtn .material-icons {\n                    font-size: 20px;\n                }\n                #requestDatasetBtn:hover {\n                    filter: brightness(0.9);\n                    transform: scale(1.05);\n                    transition: transform 0.2s;\n                }\n                .pagination-controls {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    padding: 16px;\n                }\n                .pagination-actions {\n                    display: flex;\n                    gap: 8px;\n                    align-items: center;\n                }\n                .rows-select {\n                    padding: 4px 8px;\n                    border-radius: 4px;\n                    border: 1px solid #e0e0e0;\n                    margin-right: 16px;\n                }\n                .prev-page, .next-page {\n                    padding: 4px 12px;\n                    border: 1px solid #e0e0e0;\n                    background: white;\n                    border-radius: 4px;\n                    cursor: pointer;\n                }\n                .prev-page:hover, .next-page:hover {\n                    background: #f5f5f5;\n                }\n                .prev-page.disabled, .next-page.disabled {\n                    opacity: 0.5;\n                    cursor: not-allowed;\n                }\n                .code-cell {\n                    font-family: monospace;\n                    background: #f5f5f5;\n                    padding: 2px 6px;\n                    border-radius: 4px;\n                }\n\n                /* Modal styles */\n                .modal {\n                    display: none;\n                    position: fixed;\n                    top: 0;\n                    left: 0;\n                    width: 100%;\n                    height: 100%;\n                    background: rgba(0,0,0,0.5);\n                    z-index: 1000;\n                    opacity: 0;\n                    transition: opacity 0.3s ease;\n                }\n                \n                .modal.show {\n                    display: flex;\n                    opacity: 1;\n                    align-items: center;\n                    justify-content: center;\n                }\n\n                .modal-content {\n                    background: white;\n                    border-radius: 8px;\n                    width: 90%;\n                    max-width: 500px;\n                    box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n                    transform: translateY(-20px);\n                    transition: transform 0.3s ease;\n                }\n\n                .modal.show .modal-content {\n                    transform: translateY(0);\n                }\n\n                .modal-header {\n                    padding: 20px 24px;\n                    border-bottom: 1px solid #e0e0e0;\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                }\n\n                .modal-header h3 {\n                    margin: 0;\n                    font-size: 1.25rem;\n                    color: #2c3e50;\n                    font-weight: 600;\n                }\n\n                .modal-close {\n                    font-size: 1.5rem;\n                    color: #666;\n                    cursor: pointer;\n                    padding: 4px;\n                    line-height: 1;\n                }\n\n                .modal-close:hover {\n                    color: #333;\n                }\n\n                .modal-body {\n                    padding: 24px;\n                }\n\n                .request-form {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 20px;\n                }\n\n                .form-group {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 8px;\n                }\n\n                .form-group label {\n                    font-weight: 500;\n                    color: #2c3e50;\n                }\n\n                .form-input, .form-select {\n                    padding: 8px 12px;\n                    border: 1px solid #e0e0e0;\n                    border-radius: 4px;\n                    font-size: 1rem;\n                }\n\n                .form-input:focus, .form-select:focus {\n                    border-color: #4EC4BC;\n                    outline: none;\n                    box-shadow: 0 0 0 2px rgba(78,196,188,0.2);\n                }\n\n                .form-actions {\n                    display: flex;\n                    justify-content: flex-end;\n                    gap: 12px;\n                    margin-top: 12px;\n                }\n\n                .button {\n                    padding: 8px 16px;\n                    border-radius: 4px;\n                    font-weight: 500;\n                    cursor: pointer;\n                    border: none;\n                }\n\n                .button-primary {\n                    background: #4EC4BC;\n                    color: white;\n                }\n\n                .button-primary:hover {\n                    filter: brightness(0.9);\n                }\n\n                .button-secondary {\n                    background: #e0e0e0;\n                    color: #333;\n                }\n\n                .button-secondary:hover {\n                    background: #d0d0d0;\n                }\n            </style>\n        '}disableBrowserCache(){const e=document.head;[{"http-equiv":"Cache-Control",content:"no-cache, no-store, must-revalidate"},{"http-equiv":"Pragma",content:"no-cache"},{"http-equiv":"Expires",content:"0"}].forEach((t=>{if(!document.querySelector(`meta[http-equiv="${t["http-equiv"]}"]`)){const n=document.createElement("meta");n.setAttribute("http-equiv",t["http-equiv"]),n.setAttribute("content",t.content),e.appendChild(n)}}))}loadResources(){return o(this,void 0,void 0,(function*(){return Promise.resolve()}))}}const s={version:"1.0.0",embedding:{destroy:e=>{e.innerHTML="";const t=e.instance;t&&(t.dispose(),delete e.instance,console.log("Instance disposed."))},run:(e,t,n,o,s)=>{const i=new a(e,t,n,o,s);e.instance=i}}};return t.default})()));