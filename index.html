<!-- Generated by Copilot -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Embeddings Library Test</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    #embedContainer { margin-top: 1em; padding: 1em; border: 1px solid #ddd; min-height: 300px; }
    #mockSettings { margin-top: 1em; padding: 1em; background: #f4f4f4; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>Test Embeddings Library</h1>
  
  <!-- Embedding container -->
  <div id="embedContainer"></div>
  
  <!-- Mock settings panel -->
  <div id="mockSettings">
    <h3>Mock loomeApi</h3>
    <p>The page includes a mock implementation of window.loomeApi</p>
  </div>

  <!-- Mock implementation of loomeApi -->
  <script>
    // Generated by Copilot
    // Mock implementation of window.loomeApi
    window.loomeApi = {
      get: async (url) => {
      console.log('Mock GET request to:', url);
      return {};
      },
      post: async (url, data) => {
      console.log('Mock POST request to:', url, 'with data:', data);
      return {};
      },
      put: async (url, data) => {
      console.log('Mock PUT request to:', url, 'with data:', data);
      return {};
      },
      delete: async (url, data) => {
      console.log('Mock DELETE request to:', url, 'with data:', data);
      return {};
      },
      acquireToken: async (scope) => {
      console.log('Mock token request for scope:', scope);
      return "mock-token-12345";
      },
      runApiRequest: async (id, params) => {
      console.log('Mock API request with ID:', id, 'and params:', params);
      
      // Return mock data based on the request ID
      if(id == 7){
        // Generated by Copilot
        return {
        CurrentPage: 1,
        PageCount: 1,
        PageSize: 10,
        RowCount: 5,
        FirstRowOnPage: 1,
        LastRowOnPage: 5,
        Results: [
          {
          ColumnName: "[Admission date time]",
          ColumnType: "datetime",
          LogicalColumnName: "Admission Date and time",
          BusinessDescription: "Date and time of admission to the hospital",
          ExampleValue: "2022-05-23 21:35:00.000",
          Tokenise: false,
          TokenIdentifierType: 0,
          Redact: false,
          DisplayOrder: 4,
          IsFilter: true,
          DataSetColumnID: 14,
          DataSetID: 2
          },
          {
          ColumnName: "[admission_bk]",
          ColumnType: "int",
          LogicalColumnName: "Business Key Admissions view",
          BusinessDescription: "Business Key for the Admissions view, also a columns in the ED presentations view when the presentation is linked to an admission.",
          ExampleValue: "2582894",
          Tokenise: false,
          TokenIdentifierType: 0,
          Redact: false,
          DisplayOrder: 1,
          IsFilter: false,
          DataSetColumnID: 11,
          DataSetID: 2
          },
          {
          ColumnName: "[Arrival date time]",
          ColumnType: "datetime",
          LogicalColumnName: "ED Arrival date and time",
          BusinessDescription: "Date and time of arrival to the Emergency Department",
          ExampleValue: "2022-05-23 21:35:00.000",
          Tokenise: false,
          TokenIdentifierType: 0,
          Redact: false,
          DisplayOrder: 2,
          IsFilter: true,
          DataSetColumnID: 12,
          DataSetID: 2
          },
          {
          ColumnName: "[attendance_number]",
          ColumnType: "varchar",
          LogicalColumnName: "Attendance number",
          BusinessDescription: "Unique alphanumeric sequence assigned to each Emergency Department attendance",
          ExampleValue: "2582894 (when same as admissions business key); 105252503; ED-12-039222-1",
          Tokenise: false,
          TokenIdentifierType: 0,
          Redact: true,
          DisplayOrder: 0,
          IsFilter: false,
          DataSetColumnID: 10,
          DataSetID: 2
          },
          {
          ColumnName: "[Departure date time]",
          ColumnType: "datetime",
          LogicalColumnName: "ED Departure date and time",
          BusinessDescription: "Date and time of departure from the Emergency Department",
          ExampleValue: "2022-05-23 21:35:00.000",
          Tokenise: false,
          TokenIdentifierType: 0,
          Redact: false,
          DisplayOrder: 3,
          IsFilter: true,
          DataSetColumnID: 13,
          DataSetID: 2
          }
        ]
        };
      }
      
      // Generated by Copilot
      if (id === 6) {
          return {
            Name: "AdmissionsTEST& ED presentations BH-UHG",
            Description: "Admissions and Emergency Department presentations at Barwon Health University Hospital Geelong \r\n(confirm owner & approvers once tests finished)",
            DataSourceID: 4,
            IsActive: true,
            Approvers: "ria.yangzon@bizdata.com.au",
            OptOutMessage: null,
            OptOutList: "08/05/2025 12:20:42 - Ria.Yangzon@bizdata.com.au - 1294225 \r\n08/05/2025 12:20:50 - Ria.Yangzon@bizdata.com.au - 1294280 \r\n",
            Owner: "lourdes.llorente@barwonhealth.org.au",
            OptOutColumn: "11",
            DataSetID: 2,
            ModifiedDate: "2025-05-08T04:20:55.757000",
          }
        }
        


        if (id === 4) {
          // Sample project data
          return [
            {
              name: "Project Alpha",
              projectDescription: "This is a sample project for testing",
              projectBudgetDto: { totalBudget: 10000 },
              spend: 4500,
              currency: "USD"
            },
            {
              name: "Project Beta",
              projectDescription: "Another sample project with different values",
              projectBudgetDto: { totalBudget: 5000 },
              spend: 1200,
              currency: "EUR"
            },
            {
              name: "Project Gamma",
              projectDescription: "A third sample project for testing the UI",
              projectBudgetDto: { totalBudget: 7500 },
              spend: 6000,
              currency: "GBP"
            }
          ];
        }
        
        // For auth requests, return a mock token
        return { access_token: "mock-token-12345" };
      }
    };
    
    // Error callback function
    window.errorCallback = function(title, subTitle, message, element) {
      console.error(`${title}: ${subTitle} - ${message}`);
      element.innerHTML = `
        <div style="color: red; padding: 20px; border: 1px solid red;">
          <h3>${title}</h3>
          <h4>${subTitle}</h4>
          <p>${message}</p>
        </div>
      `;
    }
  </script>

  <!-- Load and use the module -->
  <script type="module">
    // Generated by Copilot
    // Import the module
    import { definition } from './dist/custom-embedding.js';
    
    // Initialize the embedding once the DOM is loaded
    window.addEventListener('DOMContentLoaded', () => {
      // Get the container element
      const container = document.getElementById('embedContainer');
      
      // Mock parameters and settings
      const mockParams = [
        { id: 'ApiAuthRequestId', value: '123' }
      ];
      
      const mockSettings = [
        { name: 'embedType', value: '1' },
        { name: 'embedId', value: '1' }
      ];
      
      // Use the errorCallback function from global scope
      const errorHandler = window.errorCallback || function(title, subTitle, message, element) {
        console.error(`${title}: ${subTitle} - ${message}`);
        element.innerHTML = `
          <div style="color: red; padding: 20px; border: 1px solid red;">
            <h3>${title}</h3>
            <h4>${subTitle}</h4>
            <p>${message}</p>
          </div>
        `;
      };
      
      // Check if the definition object is available
      if (definition && definition.embedding && definition.embedding.run) {
        try {
          // Run the embedding
          definition.embedding.run(
            container, 
            'https://example.com/entity', 
            mockParams, 
            mockSettings, 
            errorHandler
          );
          console.log('Embedding initialized successfully');
        } catch (err) {
          console.error('Failed to initialize embedding:', err);
          errorHandler('Initialization Error', 'Failed to start embedding', err.message, container);
        }
      } else {
        console.error('Embedding definition not found in the bundle');
        container.innerHTML = '<p style="color: red;">Error: Embedding definition not found in the bundle</p>';
      }
    });
  </script>
</body>
</html>
</body>
</html>
